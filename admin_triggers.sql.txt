-- Trigger to prevent multiple Super Admins (INSERT)
DELIMITER //
CREATE TRIGGER before_admin_insert
BEFORE INSERT ON admins
FOR EACH ROW
BEGIN
    IF NEW.role = 'super_admin' AND (SELECT COUNT(*) FROM admins WHERE role = 'super_admin') >= 1 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Only one Super Admin is allowed.';
    END IF;
END //
DELIMITER ;

-- Trigger to prevent multiple Super Admins (UPDATE)
DELIMITER //
CREATE TRIGGER before_admin_update
BEFORE UPDATE ON admins
FOR EACH ROW
BEGIN
    IF NEW.role = 'super_admin' AND OLD.role != 'super_admin' AND (SELECT COUNT(*) FROM admins WHERE role = 'super_admin') >= 1 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Only one Super Admin is allowed.';
    END IF;
END //
DELIMITER ;

-- Trigger to prevent deletion of the Super Admin
DELIMITER //
CREATE TRIGGER before_admin_delete
BEFORE DELETE ON admins
FOR EACH ROW
BEGIN
    IF OLD.role = 'super_admin' THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'The Super Admin account cannot be deleted.';
    END IF;
END //
DELIMITER ;
